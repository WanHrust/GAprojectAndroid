var gcm = require('node-gcm');
var fs = require('fs');
//var mongoose = require('mongoose'); 
var event = require('config/modelEvent');    

var formidable = require("formidable");

// create a message with default values
var googleApiKey = 'AIzaSyAlOAwGDGVgt1IOEALhg7AMb7SzTiMMKqI';
exports.broadcast = function(req,res, callback) {  
	var sender = new gcm.Sender(googleApiKey);
	var message = new gcm.Message();
	var form = new formidable.IncomingForm();

	//form.parse(req, function (err, fields, files) {
	//	console.log(fields);
	//});

	new event({}).save();

	//var newEvent = new event({     
	//});  

	//newEvent.save(function (err) {   
     	//	console.log(err);
	//})

	message.addData('title','Hurry Up!');
	message.addData('message', 'Save penguins! Turn off some appliances for 10 mins');

	console.log(message);
	message.delay_while_idle = 1;
	var registrationIds = [];
	registrationIds.push('APA91bH2BORvL8aqrEWd_BKTn2-oskS2H1-q9mX5EBZ-7mQ_u9MfwZzTNRq9wxtoOAzO8Dml3_sGUV8EINXyIAC8h2l4XZDNHiI-8_zsV4Us9TWzd7fQaYYMnytKYKbY9F1PFxSGc98rlTNla5AU6_s_go43MCUOKw');

	registrationIds.push('APA91bFYqPM538b9JtL_mnT1Jjt7yKAa5vINzocEFI1tI-BtuJYCSnToexPtK-GFxterkskwcuidv0jGZ2vRuJVjm25SfbcuTWVEfvjWdbgGsKP2rlauwBxQOvY0QTdaHDrYkMtWaPXV-OLdD9GTl0eb-eO_2Zl9Iw');
	sender.send(message, registrationIds, 4, function (err, result) {
	console.log(result);
	});
}

exports.displayForm = function (res) {
    fs.readFile('broadcast.html', function (err, data) {
        res.writeHead(200, {
            'Content-Type': 'text/html',
                'Content-Length': data.length
        });
        res.write(data);
        res.end();
    });
}
